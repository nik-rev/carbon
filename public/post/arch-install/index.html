<!DOCTYPE html>
<html lang="en-us"
  dir="ltr">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width">



<link rel="icon" type="image/ico" href="http://localhost:1313//favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313//favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313//favicon-32x32.png">
<link rel="icon" type="image/png" sizes="192x192" href="http://localhost:1313//android-chrome-192x192.png">
<link rel="apple-touch-icon" sizes="180x180" href="http://localhost:1313//apple-touch-icon.png">

<meta name="description" content=""/>

<title>
    
    How I install Arch Linux with full disk encryption | Nikita Revenco
    
</title>

<link rel="canonical" href="http://localhost:1313/post/arch-install/"/>

<meta property="og:url" content="http://localhost:1313/post/arch-install/">
  <meta property="og:site_name" content="Nikita Revenco">
  <meta property="og:title" content="How I install Arch Linux with full disk encryption">
  <meta property="og:description" content="I’ve grown to love Arch Linux due to its simplicity and ease of use. However installing it can be a bit of a process, especially if you want to do it with full disk encryption.
I’ve compiled a quick guide on how I do it in this post.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="post">
    <meta property="article:published_time" content="2024-09-02T00:00:00+00:00">
    <meta property="article:modified_time" content="2024-09-02T00:00:00+00:00">













<link rel="stylesheet" href="/assets/combined.min.a904013acd8e3bd04ce56a64a8fe5525fd5f738ad6caa0bfbcbe39a8d7ed932d.css" media="all">





</head>







<body class="auto">

  <div class="content">
    <header>
      

<div class="header">

    

    <h1 class="header-title">
        <a href="http://localhost:1313/">Nikita Revenco</a>
    </h1>

    <div class="flex">
        

        
        
      
        <p class="small ">
            <a href="/" >
                /home
            </a>
        </p>
        
      
        <p class="small ">
            <a href="/posts" >
                /posts
            </a>
        </p>
        
      
        <p class="small ">
            <a href="/projects" >
                /projects
            </a>
        </p>
        
        
    </div>

    

</div>

    </header>

    <main class="main">
      





<div class="breadcrumbs">
    
    <a href="/">Home</a>
    <span class="breadcrumbs-separator"> > </span>
    
    <a href="/post/">Posts</a>
    <span class="breadcrumbs-separator"> > </span>
    
    <a class="breadcrumbs-current" href="/post/arch-install/">How I install Arch Linux with full disk encryption</a>
</div>



<div >

  <div class="single-intro-container">

    

    <h1 class="single-title">How I install Arch Linux with full disk encryption</h1>
    

    

    <p class="single-readtime">
      
      
      
      <time datetime="2024-09-02T00:00:00&#43;00:00">September 2, 2024</time>
      

      
    </p>

  </div>

  

  

  

  

  <div class="single-content">
    <p>I&rsquo;ve grown to love Arch Linux due to its simplicity and ease of use. However installing it can be a bit of a process, especially if you want to do it with full disk encryption.</p>
<p>I&rsquo;ve compiled a quick guide on how I do it in this post.</p>
<h2 class="heading" id="installation">
  Installation
  <a href="#installation">#</a>
</h2>
<p>Go to <a href="https://archlinux.org/download/">arch linux downloads</a> and head over to the <code>geo.mirror.pkgbuild.com</code> link under the &ldquo;Worldwide&rdquo; HTTP direct downloads.</p>
<p>Install the following files from there:</p>
<ul>
<li><code>archlinux-####.##.##-x86_64.iso</code></li>
<li><code>archlinux-####.##.##-x86_64.iso.sig</code></li>
</ul>
<p>Now verify the signature of the file, to ensure that is has not been tampered with:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>pacman-key -v arch.iso.sig
</span></span></code></pre></div><p>Flash the <code>.iso</code> into a device, like <code>/dev/sdc</code>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo cp arch.iso /dev/sdc
</span></span></code></pre></div><p>Boot the live environment.</p>
<p><a href="https://wiki.archlinux.org/title/Installation_guide#Connect_to_the_internet">Connect to the internet.</a></p>
<p>Setup the disk.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sgdisk -Z -n1:0:+1024M -t1:ef00 -c1:efi -n2:0:+4096M -t2:ef02 -c2:boot -N3 -t3:8309 -c3:root /dev/sda
</span></span></code></pre></div><p>Load the encryption modules.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>modprobe dm-crypt &amp;&amp; modprobe dm-mod
</span></span></code></pre></div><p>Set up the encryption and then open it.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cryptsetup luksFormat -s 512 -h sha512 /dev/sda3
</span></span><span style="display:flex;"><span>cryptsetup open /dev/sda3 luks_lvm
</span></span></code></pre></div><p>Create the volume and volume group.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>pvcreate /dev/mapper/luks_lvm
</span></span><span style="display:flex;"><span>vgcreate arch /dev/mapper/luks_lvm
</span></span></code></pre></div><p>Create a volume for your swap space. A good size for this is your RAM size (find out with <code>free -h</code>) + 2GB.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>lvcreate -n swap -L 18G arch
</span></span></code></pre></div><p>Use entire disk space for your root volume.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>lvcreate -n root -l +100%FREE arch
</span></span></code></pre></div><p>Create filesystems</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>mkfs.fat -F32 /dev/sda1
</span></span><span style="display:flex;"><span>mkfs.ext4 /dev/sda2
</span></span><span style="display:flex;"><span>mkfs.btrfs -L root /dev/mapper/arch-root
</span></span></code></pre></div><p>Setup swap device</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>mkswap /dev/mapper/arch-swap
</span></span><span style="display:flex;"><span>swapon /dev/mapper/arch-swap
</span></span><span style="display:flex;"><span>swapon -a
</span></span></code></pre></div><p>Mount Root, Boot and EFI</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>mkdir -p /mnt/boot /mnt/boot/efi
</span></span><span style="display:flex;"><span>mount /dev/mapper/arch-root /mnt
</span></span><span style="display:flex;"><span>mount /dev/sda2 /mnt/boot
</span></span><span style="display:flex;"><span>mount /dev/sda1 /mnt/boot/efi
</span></span></code></pre></div><p>Install Arch</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>pacstrap -K /mnt base sof-firmware base-devel linux linux-firmware neovim btrfs-progs lvm2 grub efibootmgr zsh
</span></span></code></pre></div><p>Load the file table and chroot.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>genfstab -U -p /mnt &gt; /mnt/etc/fstab
</span></span><span style="display:flex;"><span>arch-chroot /mnt /bin/bash
</span></span></code></pre></div><p>Add hooks.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo sed -i <span style="color:#666;font-style:italic">&#39;/^HOOKS=.*block/s/block /block encrypt lvm2 /&#39;</span> /etc/mkinitcpio.conf
</span></span></code></pre></div><p>Setup grub on efi partition</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>grub-install --efi-directory=/boot/efi
</span></span></code></pre></div><p>Add cryptdevice to linux commandline arguments</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sed -i <span style="color:#666;font-style:italic">&#39;/^GRUB_CMDLINE_LINUX_DEFAULT=/ s/&#34;$/ root=\/dev\/mapper\/arch-root cryptdevice=UUID=&#39;</span><span style="font-weight:bold;text-decoration:underline">$(</span>blkid -s UUID -o value /dev/sda3<span style="font-weight:bold;text-decoration:underline">)</span><span style="color:#666;font-style:italic">&#39;:luks_lvm&#34;/&#39;</span> /etc/default/grub
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>mkdir /secure
</span></span><span style="display:flex;"><span>dd <span style="font-weight:bold;text-decoration:underline">if</span>=/dev/random <span style="color:#666;font-weight:bold;font-style:italic">of</span>=/secure/root_keyfile.bin <span style="color:#666;font-weight:bold;font-style:italic">bs</span>=512 <span style="color:#666;font-weight:bold;font-style:italic">count</span>=8
</span></span></code></pre></div><p>Change permissions</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>chmod 000 /secure/*
</span></span><span style="display:flex;"><span>chmod 600 /boot/initramfs*
</span></span></code></pre></div><p>Add to partitions</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cryptsetup luksAddKey /dev/sda3 /secure/root_keyfile.bin
</span></span></code></pre></div><p>Recognize root keyfile</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sed -i <span style="color:#666;font-style:italic">&#39;s/FILES=()/FILES=(\/secure\/root_keyfile.bin)/&#39;</span> your_file
</span></span></code></pre></div><p>Reload linux</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>mkinitcpio -p linux
</span></span></code></pre></div><p>Create grub config</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>grub-mkconfig -o /boot/grub/grub.cfg
</span></span><span style="display:flex;"><span>grub-mkconfig -o /boot/efi/EFI/arch/grub.cfg
</span></span></code></pre></div><p>Locale</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ln -sf /usr/share/zoneinfo/Europe/London /etc/localtime
</span></span></code></pre></div><p>NTP</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="font-weight:bold;font-style:italic">echo</span> <span style="color:#666;font-style:italic">&#34;[Time]\nNTP=0.arch.pool.ntp.org 1.arch.pool.ntp.org 2.arch.pool.ntp.org 3.arch.pool.ntp.org\nFallbackNTP=0.pool.ntp.org 1.pool.ntp.org&#34;</span> &gt; /etc/systemd/timesyncd.conf
</span></span></code></pre></div><p>Enable timesyncd</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>systemctl <span style="font-weight:bold;font-style:italic">enable</span> systemd-timesyncd.service
</span></span></code></pre></div><p>Network manager for wifi</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>pacman -S networkmanager
</span></span><span style="display:flex;"><span>systemctl <span style="font-weight:bold;font-style:italic">enable</span> NetworkManager.service
</span></span></code></pre></div><p>Locale</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sed -i -e <span style="color:#666;font-style:italic">&#34;/^#&#34;</span>en_GB.UTF-8<span style="color:#666;font-style:italic">&#34;/s/^#//&#34;</span> /mnt/etc/locale.gen
</span></span><span style="display:flex;"><span><span style="font-weight:bold;font-style:italic">echo</span> <span style="color:#666;font-style:italic">&#34;KEYMAP=us&#34;</span> &gt; /etc/vconsole.conf
</span></span><span style="display:flex;"><span><span style="font-weight:bold;font-style:italic">echo</span> <span style="color:#666;font-style:italic">&#34;LANG=en_GB.UTF-8&#34;</span> &gt; /etc/locale.conf
</span></span><span style="display:flex;"><span>locale-gen
</span></span></code></pre></div><p>Hostname</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="font-weight:bold;font-style:italic">echo</span> <span style="color:#666;font-style:italic">&#34;arch&#34;</span> &gt; /etc/hostname
</span></span></code></pre></div><p>First secure the root user by setting a password</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>passwd
</span></span></code></pre></div><p>Add a new user as follows</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>useradd -m -k /var/empty -G wheel -s /bin/zsh e
</span></span><span style="display:flex;"><span>passwd e
</span></span></code></pre></div><p>Add the wheel group to sudoers</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="font-weight:bold;font-style:italic">echo</span> <span style="color:#666;font-style:italic">&#34;%wheel ALL=(ALL:ALL) ALL&#34;</span> &gt; /etc/sudoers.d/wheel
</span></span></code></pre></div><p>Install amd or intel microcode depending on which processor you use (<code>lscpu</code>):</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>pacman -S amd-ucode <span style="color:#888;font-style:italic"># or intel-ucode</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="font-weight:bold;font-style:italic">exit</span>
</span></span><span style="display:flex;"><span>umount -R /mnt
</span></span><span style="display:flex;"><span>reboot
</span></span></code></pre></div><p>Put UEFI Secure Boot into &ldquo;Setup Mode&rdquo;.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo sbctl create-keys
</span></span><span style="display:flex;"><span>sudo sbctl enroll-keys -m
</span></span></code></pre></div><p>And with that, we&rsquo;re done! Installed Arch with full disk encryption.</p>
    
  </div>

  


  

  
  

<div class="single-pagination">
    <hr />

    <div class="flex">

        <div class="single-pagination-prev">
            
            <div class="single-pagination-container-prev">
                <div class="single-pagination-text">←</div>
                <div class="single-pagination-text">
                    <a href="/post/linux-first-time/">
                        I was forced to use Linux. But now I love it.
                    </a>
                </div>
            </div>
            
        </div>

        <div class="single-pagination-next">
            
            <div class="single-pagination-container-next">
                <div class="single-pagination-text">
                    <a href="/post/useful-neovim-tricks/">
                        13 Neovim tips and life hacks that significantly improved my productivity
                    </a>
                </div>
                <div class="single-pagination-text">→</div>
            </div>
            
        </div>

    </div>

    <hr />
</div>



  

  

  
  <div class="back-to-top">
    <a href="#top">
      back to top
    </a>
  </div>
  

</div>


    </main>
  </div>

  <footer>
     
 

  </footer>

  

</body>

<script>

  function isAuto() {
    return document.body.classList.contains("auto");
  }

  function setTheme() {
    if (!isAuto()) {
      return
    }

    document.body.classList.remove("auto");
    let cls = "light";
    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
      cls = "dark";
    }

    document.body.classList.add(cls);
  }

  function invertBody() {
    document.body.classList.toggle("dark");
    document.body.classList.toggle("light");
  }

  if (isAuto()) {
    window.matchMedia('(prefers-color-scheme: dark)').addListener(invertBody);
  }

  setTheme();

</script>

<script defer src="/js/copy-code.js"></script>
</html>